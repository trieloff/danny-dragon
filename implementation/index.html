<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roadmap Roulette - Place Your Bets on What Ships Next</title>
    <link rel="icon" type="image/jpeg" href="images/favicon.jpg">
    <meta property="og:image" content="images/hero-banner.jpg">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background:
                radial-gradient(ellipse at 20% 50%, rgba(30, 90, 50, 0.8) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 50%, rgba(20, 80, 40, 0.8) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(25, 85, 45, 0.6) 0%, transparent 70%),
                linear-gradient(180deg, #0d2818 0%, #1a472a 30%, #1a5c30 50%, #1a472a 70%, #0d2818 100%);
            background-color: #0d2818;
            min-height: 100vh;
            padding: 20px;
        }

        /* Felt texture overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: linear-gradient(145deg, #1a472a 0%, #153a22 50%, #1a472a 100%);
            border-radius: 16px;
            padding: 30px;
            box-shadow:
                0 0 0 4px #8b6914,
                0 0 0 6px #d4af37,
                0 0 0 10px #8b6914,
                0 20px 60px rgba(0, 0, 0, 0.6),
                inset 0 2px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        /* Gold corner accents */
        .container::before,
        .container::after {
            content: '‚ô¶';
            position: absolute;
            font-size: 1.8rem;
            color: #d4af37;
            opacity: 0.5;
            pointer-events: none;
        }
        .container::before { top: 15px; left: 20px; }
        .container::after { bottom: 20px; right: 25px; }

        .hero-banner {
            max-width: 400px;
            height: auto;
            border-radius: 8px;
            margin-bottom: 6px;
        }

        h1 {
            font-family: 'Playfair Display', Georgia, serif;
            color: #d4af37;
            margin-bottom: 6px;
            font-size: 2.8rem;
            font-weight: 900;
            text-shadow:
                0 0 10px rgba(212, 175, 55, 0.5),
                0 0 20px rgba(212, 175, 55, 0.3),
                0 0 40px rgba(212, 175, 55, 0.15),
                0 2px 4px rgba(0, 0, 0, 0.5);
            animation: neonPulse 3s ease-in-out infinite;
        }

        /* Empty quarter placeholder */
        .empty-slot {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0.6;
            transition: opacity 0.3s;
        }

        .empty-slot img {
            max-width: 120px;
            height: auto;
            border-radius: 8px;
            filter: brightness(0.8);
        }

        .quarter-column:hover .empty-slot {
            opacity: 0.9;
        }

        /* Spin overlay */
        .spin-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }

        .spin-popup {
            background: linear-gradient(145deg, #1a472a 0%, #153a22 100%);
            border-radius: 16px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            position: relative;
            box-shadow:
                0 0 0 4px #8b6914,
                0 0 0 6px #d4af37,
                0 0 0 10px #8b6914,
                0 20px 60px rgba(0, 0, 0, 0.8),
                0 0 40px rgba(212, 175, 55, 0.4);
            animation: popupBounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            text-align: center;
        }

        .spin-popup video {
            display: block;
            max-width: 400px;
            max-height: 400px;
            border-radius: 8px;
            border: 3px solid #d4af37;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
            margin: 0 auto;
        }

        .spin-title {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 2rem;
            font-weight: 900;
            color: #d4af37;
            text-align: center;
            margin-bottom: 20px;
            text-shadow:
                0 0 10px rgba(212, 175, 55, 0.8),
                0 0 20px rgba(212, 175, 55, 0.5),
                0 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* Bet placed overlay - smaller and quicker */
        .bet-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.2s ease-out;
        }

        .bet-popup {
            background: linear-gradient(145deg, #1a472a 0%, #153a22 100%);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            box-shadow:
                0 0 0 4px #8b6914,
                0 0 0 6px #d4af37,
                0 0 0 10px #8b6914,
                0 20px 60px rgba(0, 0, 0, 0.8),
                0 0 40px rgba(212, 175, 55, 0.4);
            animation: popupBounce 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            text-align: center;
        }

        .bet-popup video {
            display: block;
            max-width: 300px;
            max-height: 300px;
            border-radius: 8px;
            border: 3px solid #d4af37;
            margin: 0 auto;
        }

        .bet-title {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.5rem;
            font-weight: 900;
            color: #d4af37;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.8), 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        @keyframes neonPulse {
            0%, 100% { text-shadow: 0 0 10px rgba(212,175,55,0.5), 0 0 20px rgba(212,175,55,0.3), 0 0 40px rgba(212,175,55,0.15), 0 2px 4px rgba(0,0,0,0.5); }
            50% { text-shadow: 0 0 15px rgba(212,175,55,0.7), 0 0 30px rgba(212,175,55,0.4), 0 0 60px rgba(212,175,55,0.2), 0 2px 4px rgba(0,0,0,0.5); }
        }

        .header-area {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }

        .header-text {
            flex: 1;
        }

        .subtitle {
            color: #a8c5a0;
            margin-bottom: 0;
            font-size: 1.1rem;
            font-style: italic;
            letter-spacing: 0.5px;
        }

        .spin-button {
            background: linear-gradient(145deg, #d4af37 0%, #b8960c 50%, #d4af37 100%);
            color: #1a2e1a;
            padding: 14px 28px;
            border: 2px solid #f0d060;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow:
                0 4px 15px rgba(212, 175, 55, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
            animation: shimmer 3s ease-in-out infinite;
            white-space: nowrap;
        }

        .spin-button:hover {
            background: linear-gradient(145deg, #f0d060 0%, #d4af37 50%, #f0d060 100%);
            box-shadow:
                0 6px 25px rgba(212, 175, 55, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .spin-button:active {
            transform: translateY(0) scale(0.97);
        }

        .spin-button.no-bets {
            animation: headShake 0.5s ease-in-out;
        }

        @keyframes headShake {
            0% { transform: translateX(0); }
            15% { transform: translateX(-6px); }
            30% { transform: translateX(5px); }
            45% { transform: translateX(-4px); }
            60% { transform: translateX(3px); }
            75% { transform: translateX(-1px); }
            100% { transform: translateX(0); }
        }

        .spin-button.spinning {
            animation: spinButtonPulse 0.6s ease-in-out;
        }

        @keyframes spinButtonPulse {
            0% { transform: scale(1); }
            25% { transform: scale(1.1) rotate(-3deg); }
            50% { transform: scale(0.95) rotate(3deg); }
            75% { transform: scale(1.05) rotate(-1deg); }
            100% { transform: scale(1); }
        }

        @keyframes shimmer {
            0%, 100% { box-shadow: 0 4px 15px rgba(212,175,55,0.4), inset 0 1px 0 rgba(255,255,255,0.3); }
            50% { box-shadow: 0 4px 25px rgba(212,175,55,0.6), inset 0 1px 0 rgba(255,255,255,0.4); }
        }

        .chart-container {
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(145deg, #0d1f14 0%, #132b1a 100%);
            border-radius: 10px;
            border: 2px solid #d4af37;
            box-shadow:
                0 0 15px rgba(212, 175, 55, 0.15),
                inset 0 1px 10px rgba(0, 0, 0, 0.3);
        }

        .chart-title {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.3rem;
            color: #d4af37;
            margin-bottom: 15px;
            font-weight: 700;
        }

        #balanceChart {
            max-height: 300px;
        }

        .quarters-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .roulette-rail {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin-bottom: 15px;
            padding: 8px 0;
            opacity: 0.6;
            overflow: hidden;
        }

        .rail-number {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
        }

        .rail-number.red { background: #dc2626; }
        .rail-number.black { background: #1a1a2e; }
        .rail-number.green { background: #16a34a; }

        .quarter-column {
            background: linear-gradient(180deg, rgba(26, 71, 42, 0.6) 0%, rgba(13, 40, 24, 0.6) 100%);
            border-radius: 10px;
            padding: 15px;
            min-height: 400px;
            border: 2px solid rgba(212, 175, 55, 0.3);
            transition: all 0.3s;
        }

        .quarter-column.drag-over {
            background: linear-gradient(180deg, rgba(50, 100, 60, 0.8) 0%, rgba(30, 70, 40, 0.8) 100%);
            border-color: #d4af37;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3), inset 0 0 20px rgba(212, 175, 55, 0.1);
        }

        .quarter-column[data-quarter="Backlog"] {
            background: linear-gradient(180deg, rgba(40, 25, 15, 0.7) 0%, rgba(25, 15, 10, 0.7) 100%);
            border: 2px dashed rgba(212, 175, 55, 0.4);
        }

        .quarter-column[data-quarter="Backlog"] .quarter-header {
            background: linear-gradient(145deg, rgba(180, 120, 40, 0.2) 0%, rgba(140, 90, 20, 0.1) 100%);
            border-color: rgba(180, 120, 40, 0.4);
        }

        .empty-placeholder {
            color: rgba(168, 197, 160, 0.4);
            text-align: center;
            font-style: italic;
            padding: 30px 10px;
            font-size: 0.9rem;
        }

        .quarter-header {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.25rem;
            font-variant: small-caps;
            font-weight: 700;
            color: #d4af37;
            margin-bottom: 15px;
            padding: 10px 20px;
            background: linear-gradient(145deg, rgba(212, 175, 55, 0.25) 0%, rgba(212, 175, 55, 0.05) 100%);
            border-radius: 20px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .initiative-card {
            background: linear-gradient(145deg, #faf8f0 0%, #f5f0e0 100%);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            cursor: move;
            border-left: 5px solid;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        /* Card corner decorations */
        .initiative-card::before,
        .initiative-card::after {
            font-size: 0.75rem;
            color: rgba(0, 0, 0, 0.3);
            position: absolute;
        }
        .initiative-card::before {
            content: '‚ô†';
            top: 4px;
            right: 6px;
        }
        .initiative-card::after {
            content: '‚ô£';
            bottom: 4px;
            left: 8px;

        .initiative-card.growth::before { content: '‚ô†'; color: rgba(16, 185, 129, 0.35); }
        .initiative-card.retention::before { content: '‚ô¶'; color: rgba(59, 130, 246, 0.35); }
        .initiative-card.tech_debt::before { content: '‚ô£'; color: rgba(245, 158, 11, 0.35); }
        .initiative-card.compliance::before { content: '‚ô•'; color: rgba(239, 68, 68, 0.35); }
        }

        .initiative-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3), 0 0 12px rgba(212, 175, 55, 0.3);
            outline: 2px solid rgba(212, 175, 55, 0.5);
            outline-offset: -1px;
        }

        .initiative-card.dragging {
            opacity: 0.5;
            transform: rotate(3deg);
        }

        .initiative-card.card-landing {
            animation: cardBounce 0.4s ease-out;
        }

        .initiative-card.card-flip {
            animation: cardFlip 0.6s ease-out;
        }

        @keyframes cardBounce {
            0% { transform: scale(0.9); opacity: 0.7; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes cardFlip {
            0% { transform: perspective(400px) rotateY(90deg); opacity: 0; }
            50% { transform: perspective(400px) rotateY(-10deg); opacity: 1; }
            75% { transform: perspective(400px) rotateY(5deg); }
            100% { transform: perspective(400px) rotateY(0deg); }
        }

        .initiative-card.growth {
            border-left-color: #10b981;
        }

        .initiative-card.retention {
            border-left-color: #3b82f6;
        }

        .initiative-card.tech_debt {
            border-left-color: #f59e0b;
        }

        .initiative-card.compliance {
            border-left-color: #ef4444;
        }

        .initiative-name {
            font-weight: 700;
            color: #1a2e1a;
            margin-bottom: 6px;
            font-size: 0.95rem;
        }

        .initiative-description {
            font-size: 0.85rem;
            color: #5a6a5a;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .badges {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }

        .badge.growth {
            background: #10b981;
        }

        .badge.retention {
            background: #3b82f6;
        }

        .badge.tech_debt {
            background: #f59e0b;
        }

        .badge.compliance {
            background: #ef4444;
        }

        .badge.size {
            background: #5a6a5a;
        }

        .add-initiative-section {
            background: linear-gradient(145deg, #0d1f14 0%, #132b1a 100%);
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #d4af37;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.15), inset 0 1px 10px rgba(0, 0, 0, 0.3);
        }

        .add-initiative-section h2 {
            font-family: 'Playfair Display', Georgia, serif;
            color: #d4af37;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-weight: 600;
            color: #a8c5a0;
            margin-bottom: 6px;
            font-size: 0.9rem;
        }

        input, textarea, select {
            padding: 10px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 6px;
            font-size: 0.95rem;
            font-family: inherit;
            background: rgba(10, 25, 15, 0.8);
            color: #e0e8d8;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.15);
        }

        input::placeholder, textarea::placeholder {
            color: rgba(168, 197, 160, 0.5);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        select option {
            background: #132b1a;
            color: #e0e8d8;
        }

        button[type="submit"] {
            background: linear-gradient(145deg, #d4af37 0%, #b8960c 50%, #d4af37 100%);
            color: #1a2e1a;
            padding: 12px 24px;
            border: 2px solid #f0d060;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button[type="submit"]:hover {
            background: linear-gradient(145deg, #f0d060 0%, #d4af37 50%, #f0d060 100%);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
            transform: translateY(-1px);
        }

        button[type="submit"]:active {
            transform: scale(0.98);
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(13, 31, 20, 0.6);
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            box-shadow:
                inset 0 0 0 3px rgba(255, 255, 255, 0.2),
                inset 0 0 0 5px rgba(0, 0, 0, 0.15),
                0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .legend-label {
            font-size: 0.9rem;
            color: #c8d8c0;
            font-weight: 500;
        }

        /* Capacity Meter Styles */
        .capacity-meter {
            margin-top: 8px;
            margin-bottom: 8px;
        }

        .capacity-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            margin-bottom: 4px;
        }

        .capacity-text {
            color: #c5d9c0;
            font-weight: 600;
        }

        .capacity-text.ok {
            color: #10b981;
        }

        .capacity-text.warning {
            color: #f59e0b;
        }

        .capacity-text.overload {
            color: #ef4444;
        }

        .capacity-bar {
            height: 6px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .capacity-fill {
            height: 100%;
            transition: width 0.3s, background 0.3s;
            border-radius: 3px;
        }

        .capacity-fill.ok {
            background: #10b981;
        }

        .capacity-fill.warning {
            background: #f59e0b;
        }

        .capacity-fill.overload {
            background: #ef4444;
        }

        .warning-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 6px;
            background: #ef4444;
            color: white;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        /* Dependency Styles */
        .dependency-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 2px 6px;
            background: rgba(212, 175, 55, 0.2);
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.8rem;
        }

        .dependency-icon:hover {
            background: rgba(212, 175, 55, 0.3);
        }

        .dependency-icon.has-deps {
            background: rgba(212, 175, 55, 0.4);
            color: #d4af37;
        }

        .dependency-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .quarters-grid-wrapper {
            position: relative;
        }

        /* Export Button Styles */
        .export-button {
            background: linear-gradient(145deg, #10b981 0%, #059669 50%, #10b981 100%);
            color: white;
            padding: 12px 24px;
            border: 2px solid #34d399;
            border-radius: 50px;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            transition: all 0.3s;
            white-space: nowrap;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .export-button:hover {
            background: linear-gradient(145deg, #34d399 0%, #10b981 50%, #34d399 100%);
            box-shadow: 0 6px 25px rgba(16, 185, 129, 0.5);
            transform: translateY(-2px);
        }

        .snapshot-banner {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            color: #92400e;
        }

        /* Toggle Container Styles */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: #d4af37;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: rgba(212, 175, 55, 0.3);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .toggle-label {
            font-size: 0.9rem;
            color: #c5d9c0;
            font-weight: 500;
        }

        @media (max-width: 1200px) {
            .quarters-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Completion button */
        .complete-button {
            position: absolute;
            top: 8px;
            right: 8px;
            background: linear-gradient(145deg, #d4af37 0%, #b8960c 100%);
            border: 2px solid #f0d060;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s;
            z-index: 10;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .complete-button:hover {
            background: linear-gradient(145deg, #f0d060 0%, #d4af37 100%);
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 3px 10px rgba(212, 175, 55, 0.5);
        }

        .complete-button:active {
            transform: scale(0.95);
        }

        /* Completed card styling */
        .initiative-card.completed {
            opacity: 0.8;
            position: relative;
            border: 3px solid #d4af37;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4), 0 3px 8px rgba(0, 0, 0, 0.3);
        }

        .initiative-card.completed::after {
            content: 'üèÜ WINNER';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 1.5rem;
            font-weight: 900;
            color: #d4af37;
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.8),
                0 0 10px rgba(212, 175, 55, 0.6);
            pointer-events: none;
            z-index: 5;
            letter-spacing: 2px;
        }

        .initiative-card.completed .complete-button {
            background: linear-gradient(145deg, #10b981 0%, #059669 100%);
            border-color: #34d399;
        }

        /* Celebration popup overlay */
        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Celebration popup */
        .celebration-popup {
            background: linear-gradient(145deg, #1a472a 0%, #153a22 100%);
            border-radius: 16px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            position: relative;
            box-shadow:
                0 0 0 4px #8b6914,
                0 0 0 6px #d4af37,
                0 0 0 10px #8b6914,
                0 20px 60px rgba(0, 0, 0, 0.8),
                0 0 40px rgba(212, 175, 55, 0.4);
            animation: popupBounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popupBounce {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .celebration-popup video {
            display: block;
            max-width: 600px;
            max-height: 600px;
            border-radius: 8px;
            border: 3px solid #d4af37;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
        }

        .celebration-content {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .celebration-popup img {
            display: block;
            max-width: 300px;
            max-height: 600px;
            border-radius: 8px;
            border: 3px solid #d4af37;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
            animation: dancingImage 1s ease-in-out infinite;
        }

        @keyframes dancingImage {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-10px) rotate(-5deg);
            }
            50% {
                transform: translateY(0) rotate(0deg);
            }
            75% {
                transform: translateY(-10px) rotate(5deg);
            }
        }

        .celebration-title {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 2.5rem;
            font-weight: 900;
            color: #d4af37;
            text-align: center;
            margin-bottom: 20px;
            text-shadow:
                0 0 10px rgba(212, 175, 55, 0.8),
                0 0 20px rgba(212, 175, 55, 0.5),
                0 2px 4px rgba(0, 0, 0, 0.5);
            animation: jackpotPulse 1s ease-in-out infinite;
        }

        @keyframes jackpotPulse {
            0%, 100% {
                transform: scale(1);
                text-shadow: 0 0 10px rgba(212,175,55,0.8), 0 0 20px rgba(212,175,55,0.5), 0 2px 4px rgba(0,0,0,0.5);
            }
            50% {
                transform: scale(1.05);
                text-shadow: 0 0 20px rgba(212,175,55,1), 0 0 40px rgba(212,175,55,0.7), 0 2px 4px rgba(0,0,0,0.5);
            }
        }

        .close-celebration {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(239, 68, 68, 0.9);
            border: 2px solid #fee;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.3rem;
            color: white;
            font-weight: bold;
            transition: all 0.3s;
            z-index: 10;
        }

        .close-celebration:hover {
            background: #dc2626;
            transform: rotate(90deg) scale(1.1);
        }

        @media (max-width: 768px) {
            .quarters-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2rem;
            }

            .header-area {
                flex-direction: column;
            }

            .celebration-popup {
                padding: 20px;
            }

            .celebration-content {
                flex-direction: column;
            }

            .celebration-popup video {
                max-width: 100%;
                max-height: 400px;
            }

            .celebration-popup img {
                max-width: 100%;
                max-height: 300px;
            }

            .celebration-title {
                font-size: 1.8rem;
            }

            .spin-popup video {
                max-width: 100%;
                max-height: 300px;
            }

            .bet-popup video {
                max-width: 100%;
                max-height: 250px;
            }

            .hero-banner {
                max-width: 280px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-area">
            <div class="header-text">
                <img src="images/hero-banner.jpg" alt="Roadmap Roulette" class="hero-banner">
                <p class="subtitle">Place your bets on what ships next</p>
            </div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="export-button" id="exportButton">üì• Export</button>
                <button class="spin-button" id="spinButton" onclick="spinTheWheel()">üé≤ Spin the Wheel</button>
            </div>
        </div>

        <!-- Theme Legend -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #10b981;"></div>
                <span class="legend-label">High Roller (Growth)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3b82f6;"></div>
                <span class="legend-label">Lucky Streak (Retention)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f59e0b;"></div>
                <span class="legend-label">House Edge (Tech Debt)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ef4444;"></div>
                <span class="legend-label">Table Stakes (Compliance)</span>
            </div>
        </div>

        <!-- Balance Chart -->
        <div class="chart-container">
            <h2 class="chart-title">üé≤ The Odds Board ‚Äî Theme Balance</h2>
            <div class="toggle-container">
                <span class="toggle-label">Count</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="chartModeToggle">
                    <span class="toggle-slider"></span>
                </label>
                <span class="toggle-label">Effort Points</span>
            </div>
            <canvas id="balanceChart"></canvas>
        </div>

        <!-- Roulette Rail -->
        <div class="roulette-rail" id="rouletteRail"></div>

        <!-- Quarter Columns -->
        <div class="quarters-grid-wrapper">
            <svg class="dependency-svg" id="dependencySvg"></svg>
            <div class="quarters-grid" id="quartersGrid">
                <!-- Dynamically populated -->
            </div>
        </div>

        <!-- Add Initiative Form -->
        <div class="add-initiative-section">
            <h2>üÉè Place a New Bet</h2>
            <form id="addInitiativeForm">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="initiativeName">Initiative Name</label>
                        <input type="text" id="initiativeName" required placeholder="e.g., AI Content Recommendations">
                    </div>
                    <div class="form-group full-width">
                        <label for="initiativeDescription">Description</label>
                        <textarea id="initiativeDescription" required placeholder="One-sentence explanation of the initiative"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="initiativeTheme">Theme</label>
                        <select id="initiativeTheme" required>
                            <option value="growth">High Roller (Growth)</option>
                            <option value="retention">Lucky Streak (Retention)</option>
                            <option value="tech_debt">House Edge (Tech Debt)</option>
                            <option value="compliance">Table Stakes (Compliance)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="initiativeSize">Size</label>
                        <select id="initiativeSize" required>
                            <option value="XS">XS (1-2 weeks)</option>
                            <option value="S">S (3-4 weeks)</option>
                            <option value="M">M (1-2 months)</option>
                            <option value="L">L (3-4 months)</option>
                            <option value="XL">XL (5+ months)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="initiativeQuarter">Table Position</label>
                        <select id="initiativeQuarter" required>
                            <option value="Q1">Q1</option>
                            <option value="Q2">Q2</option>
                            <option value="Q3">Q3</option>
                            <option value="Q4">Q4</option>
                            <option value="Backlog">House Reserve</option>
                        </select>
                    </div>
                </div>
                <button type="submit">üé∞ Place Bet</button>
            </form>
        </div>
    </div>

    <script>
        // Mock data - 8 initiatives as specified
        const ROADMAP_DATA = {
            initiatives: [
                {
                    id: 1,
                    name: "Blockchain-Powered Query Result Notarization Pipeline",
                    description: "Mint every query result as an NFT with PDF certificates of authenticity per row",
                    theme: "tech_debt",
                    size: "XL",
                    quarter: "Q1",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 2,
                    name: "IE 5.5 on Windows ME Compatibility",
                    description: "Dashboard must render in Internet Explorer 5.5 on Windows ME ‚Äî the CEO's nephew starts Monday",
                    theme: "compliance",
                    size: "L",
                    quarter: "Q1",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 3,
                    name: "AI Sentiment Analysis of Error Messages",
                    description: "Classify errors on the K√ºbler-Ross grief scale, auto-order pizza when Frustration Index exceeds 8.5",
                    theme: "growth",
                    size: "XL",
                    quarter: "Q2",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 4,
                    name: "Migrate Frontend to Enterprise Service Bus",
                    description: "Replace all function calls with XML-envelope-wrapped async message queues per the 247-page whitepaper",
                    theme: "tech_debt",
                    size: "XL",
                    quarter: "Q2",
                    dependencies: [1],
                    completed: false
                },
                {
                    id: 5,
                    name: "27-Step OAuth Flow for Localhost",
                    description: "Retinal scan, blood oath, and 3 VP approvals required before npm start",
                    theme: "compliance",
                    size: "L",
                    quarter: "Q3",
                    dependencies: [4],
                    completed: false
                },
                {
                    id: 6,
                    name: "Lunar-Phase-Adjusted Dark Mode",
                    description: "Dark mode activates at civil twilight. Full moon enables Werewolf Mode with Papyrus font",
                    theme: "retention",
                    size: "M",
                    quarter: "Q3",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 7,
                    name: "CSV Export / Standing Desk Procurement Bug",
                    description: "Export to CSV accidentally orders 400 standing desks at $749 each. Warehouse now 60% desks by volume",
                    theme: "retention",
                    size: "S",
                    quarter: "Q4",
                    dependencies: [2],
                    completed: false
                },
                {
                    id: 8,
                    name: "Kubernetes Cluster for the Coffee Machine",
                    description: "Deploy a 12-node K8s cluster to manage the office Nespresso. Each pod brews one cup. Auto-scales on Monday mornings",
                    theme: "tech_debt",
                    size: "L",
                    quarter: "Q1",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 9,
                    name: "Mandatory Microservice per Database Column",
                    description: "Architecture Review Board requires each column to be its own independently deployable microservice with a dedicated Slack channel",
                    theme: "tech_debt",
                    size: "XL",
                    quarter: "Q1",
                    dependencies: [4],
                    completed: false
                },
                {
                    id: 10,
                    name: "BUG: Pie Chart Summing to 103%",
                    description: "VP of Sales insists his department deserves 103%. Legal says we can't cap it. Marketing wants their own pie",
                    theme: "compliance",
                    size: "XS",
                    quarter: "Q2",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 11,
                    name: "AI-Generated Sprint Retrospective Excuses",
                    description: "GPT-powered excuse engine for why stories weren't completed. Integrates with Jira, guilt, and middle management",
                    theme: "growth",
                    size: "M",
                    quarter: "Q2",
                    dependencies: [3],
                    completed: false
                },
                {
                    id: 12,
                    name: "GDPR Compliance for Imaginary Users",
                    description: "Legal requires right-to-be-forgotten for test accounts, fictional personas, and that one user named 'asdf asdf'",
                    theme: "compliance",
                    size: "M",
                    quarter: "Q3",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 13,
                    name: "Dashboard Load Time Under 45 Minutes SLA",
                    description: "Performance tiger team to reduce initial load from 2 hours to 45 minutes. Stretch goal: under 30 minutes on fiber",
                    theme: "growth",
                    size: "L",
                    quarter: "Q3",
                    dependencies: [9],
                    completed: false
                },
                {
                    id: 14,
                    name: "Single Sign-On via Carrier Pigeon",
                    description: "Air-gapped environments need auth too. Each login attempt dispatches a pigeon to the IdP. SLA: 3-5 business days",
                    theme: "compliance",
                    size: "S",
                    quarter: "Q4",
                    dependencies: [5],
                    completed: false
                },
                {
                    id: 15,
                    name: "BUG: Tooltip Appears in Wrong Hemisphere",
                    description: "Users in Australia report tooltips render upside down. Southern hemisphere CSS transform matrix needs inversion",
                    theme: "retention",
                    size: "XS",
                    quarter: "Q4",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 16,
                    name: "Machine Learning Model to Predict Meetings About Meetings",
                    description: "Train on 3 years of calendar data to forecast recursive meeting loops. Alert before you're trapped in a pre-sync for a pre-standup",
                    theme: "growth",
                    size: "XL",
                    quarter: "Backlog",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 17,
                    name: "Replace All Integers with Enterprise BigDecimal Objects",
                    description: "Finance mandates that the number 7 must be stored as BigDecimal(7.0000000000000000). Add 40KB per digit",
                    theme: "tech_debt",
                    size: "L",
                    quarter: "Backlog",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 18,
                    name: "Implement Undo Button for Emails Sent by CEO",
                    description: "CEO wants to unsend reply-all from 2019. Requires time-travel API, quantum state rollback, and an NDA",
                    theme: "retention",
                    size: "XL",
                    quarter: "Backlog",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 19,
                    name: "BUG: 404 Page More Popular Than Homepage",
                    description: "Analytics show 404 page has 12x engagement. Product wants to A/B test making it the new landing page",
                    theme: "growth",
                    size: "S",
                    quarter: "Q1",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 20,
                    name: "Compliance Audit of the Compliance Audit Tool",
                    description: "The tool we built to audit compliance has itself never been audited. Auditors are auditing the auditors. Turtles all the way down",
                    theme: "compliance",
                    size: "M",
                    quarter: "Q4",
                    dependencies: [12],
                    completed: false
                },
                {
                    id: 21,
                    name: "Six Sigma Black Belt Certification for CI/CD Pipeline",
                    description: "Each deployment must achieve 3.4 defects per million builds. Pipeline now includes a kaizen event and a gemba walk",
                    theme: "tech_debt",
                    size: "M",
                    quarter: "Backlog",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 22,
                    name: "BUG: Scrollbar Has Existential Crisis",
                    description: "Scrollbar oscillates between visible and hidden at 60fps. Developers suspect it's questioning its purpose. Therapy not covered by vendor SLA",
                    theme: "retention",
                    size: "XS",
                    quarter: "Q1",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 23,
                    name: "Enterprise-Grade Lorem Ipsum Generator",
                    description: "Legal rejected standard lorem ipsum ‚Äî unlicensed Latin. Build proprietary placeholder text using only approved corporate buzzwords",
                    theme: "compliance",
                    size: "S",
                    quarter: "Q1",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 24,
                    name: "Migrate All Booleans to Enums With 17 States",
                    description: "true/false deemed insufficiently nuanced. New values include PROBABLY, ALLEGEDLY, PER_MY_LAST_EMAIL, and PENDING_LEGAL_REVIEW",
                    theme: "tech_debt",
                    size: "L",
                    quarter: "Q1",
                    dependencies: [17],
                    completed: false
                },
                {
                    id: 25,
                    name: "Auto-Generate Cover Sheets for All TPS Reports",
                    description: "New memo: all query exports require the updated TPS cover sheet. Did you get that memo? We're putting cover sheets on all TPS reports now",
                    theme: "compliance",
                    size: "M",
                    quarter: "Q2",
                    dependencies: [7],
                    completed: false
                },
                {
                    id: 26,
                    name: "BUG: Dashboard Works Perfectly ‚Äî Nobody Trusts It",
                    description: "Zero defects found but stakeholders refuse to believe data without a manual Excel cross-check. Implement deliberate minor errors to build trust",
                    theme: "retention",
                    size: "S",
                    quarter: "Q2",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 27,
                    name: "Quantum Computing Readiness Assessment",
                    description: "CTO read an article on the plane. All code must now be quantum-ready. Nobody knows what this means but the RFP is due Friday",
                    theme: "growth",
                    size: "XL",
                    quarter: "Q2",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 28,
                    name: "Intern-Proof the Delete Button",
                    description: "After The Incident, all destructive actions require solving a CAPTCHA, a Sudoku, and a brief essay on the consequences of one's actions",
                    theme: "compliance",
                    size: "M",
                    quarter: "Q3",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 29,
                    name: "Implement OKRs for the OKR Tracking Dashboard",
                    description: "The dashboard tracking our OKRs has no OKRs. Key result: track 100% of key results. Objective: have objectives",
                    theme: "growth",
                    size: "S",
                    quarter: "Q3",
                    dependencies: [11],
                    completed: false
                },
                {
                    id: 30,
                    name: "BUG: Prod Database Running on Intern's Laptop",
                    description: "Discovered during offboarding. Laptop has a sticker that says 'DO NOT TURN OFF'. Uptime: 847 days. Intern graduated 2 years ago",
                    theme: "tech_debt",
                    size: "XL",
                    quarter: "Q3",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 31,
                    name: "Committee to Form a Committee on Technical Debt",
                    description: "Steering committee voted to establish a subcommittee to evaluate forming an advisory board on tech debt prioritization. Meets bi-annually",
                    theme: "tech_debt",
                    size: "XS",
                    quarter: "Q4",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 32,
                    name: "Translate All Error Codes to Passive-Aggressive",
                    description: "Per the new Tone & Voice guidelines: HTTP 500 becomes 'I'm fine. Everything's fine.' HTTP 403 becomes 'I just think it's funny how...'",
                    theme: "retention",
                    size: "M",
                    quarter: "Q4",
                    dependencies: [3],
                    completed: false
                },
                {
                    id: 33,
                    name: "Feature: Print Dashboard to Fax Machine",
                    description: "Board member's preferred medium. Must support thermal paper, cover page with company logo, and auto-redial on busy signal. Max 14.4 kbps",
                    theme: "growth",
                    size: "L",
                    quarter: "Backlog",
                    dependencies: [2],
                    completed: false
                },
                {
                    id: 34,
                    name: "BUG: Nobody Reads the Documentation We Spent 6 Months Writing",
                    description: "Analytics confirm 0 page views. Entire docs site indexed only by a bot from a Russian SEO farm. Consider converting to podcast format",
                    theme: "retention",
                    size: "XS",
                    quarter: "Backlog",
                    dependencies: [],
                    completed: false
                },
                {
                    id: 35,
                    name: "Implement Synergy Maximization Engine",
                    description: "Board wants to leverage core competencies to synergize cross-functional alignment. Deliverable: a button labeled 'Synergize' that does nothing",
                    theme: "growth",
                    size: "L",
                    quarter: "Backlog",
                    dependencies: [16],
                    completed: false
                }
            ],
            themes: ["growth", "retention", "tech_debt", "compliance"],
            sizes: ["XS", "S", "M", "L", "XL"],
            quarters: ["Q1", "Q2", "Q3", "Q4", "Backlog"]
        };

        // Theme color mapping
        const THEME_COLORS = {
            growth: "#10b981",
            retention: "#3b82f6",
            tech_debt: "#f59e0b",
            compliance: "#ef4444"
        };

        // Theme display names (casino-themed)
        const THEME_NAMES = {
            growth: "High Roller",
            retention: "Lucky Streak",
            tech_debt: "House Edge",
            compliance: "Table Stakes"
        };

        // Quarter display names
        const QUARTER_DISPLAY = {
            Q1: "Q1",
            Q2: "Q2",
            Q3: "Q3",
            Q4: "Q4",
            Backlog: "üè† House Reserve"
        };

        // Size weight mapping for effort calculation
        const SIZE_WEIGHTS = {
            XS: 1,
            S: 2,
            M: 3,
            L: 5,
            XL: 8
        };

        // Quarter capacity limit
        const QUARTER_CAPACITY = 12;

        // Global chart instance
        let balanceChart = null;
        
        // Chart mode: 'count' or 'weighted'
        let chartMode = 'count';

        // Calculate capacity for a quarter
        function calculateCapacity(quarter) {
            const initiatives = ROADMAP_DATA.initiatives.filter(init => init.quarter === quarter);
            const totalEffort = initiatives.reduce((sum, init) => sum + SIZE_WEIGHTS[init.size], 0);
            return totalEffort;
        }

        // Get capacity status
        function getCapacityStatus(effort) {
            if (effort <= 8) return 'ok';
            if (effort <= QUARTER_CAPACITY) return 'warning';
            return 'overload';
        }

        // Calculate balance data for chart
        function calculateBalance() {
            const balance = {};
            
            // Initialize all quarters with zero counts for all themes
            ROADMAP_DATA.quarters.forEach(quarter => {
                if (quarter !== "Backlog") {
                    balance[quarter] = {};
                    ROADMAP_DATA.themes.forEach(theme => {
                        balance[quarter][theme] = 0;
                    });
                }
            });

            // Count or sum effort points per quarter per theme
            ROADMAP_DATA.initiatives.forEach(initiative => {
                if (initiative.quarter !== "Backlog" && balance[initiative.quarter]) {
                    if (chartMode === 'weighted') {
                        balance[initiative.quarter][initiative.theme] += SIZE_WEIGHTS[initiative.size];
                    } else {
                        balance[initiative.quarter][initiative.theme]++;
                    }
                }
            });

            return balance;
        }

        // Render or update the Chart.js stacked bar chart
        function renderChart() {
            const balanceData = calculateBalance();
            const quarters = ["Q1", "Q2", "Q3", "Q4"];

            // Prepare datasets - one per theme
            const datasets = ROADMAP_DATA.themes.map(theme => ({
                label: THEME_NAMES[theme],
                data: quarters.map(quarter => balanceData[quarter][theme]),
                backgroundColor: THEME_COLORS[theme],
                borderColor: THEME_COLORS[theme],
                borderWidth: 1
            }));

            const yAxisLabel = chartMode === 'weighted' ? 'Effort Points' : 'Number of Initiatives';

            const chartConfig = {
                type: 'bar',
                data: {
                    labels: quarters,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#f0e6c8',
                                font: { size: 13 }
                            }
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#a8c5a0'
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                color: '#a8c5a0'
                            },
                            grid: {
                                color: 'rgba(212, 175, 55, 0.1)'
                            },
                            title: {
                                display: true,
                                text: yAxisLabel,
                                color: '#a8c5a0'
                            }
                        }
                    }
                }
            };

            // Create or update chart
            if (balanceChart) {
                balanceChart.data = chartConfig.data;
                balanceChart.options.scales.y.title.text = yAxisLabel;
                balanceChart.update();
            } else {
                const ctx = document.getElementById('balanceChart').getContext('2d');
                balanceChart = new Chart(ctx, chartConfig);
            }
        }

        // Render quarter columns with initiative cards
        function renderQuarters() {
            const grid = document.getElementById('quartersGrid');
            grid.innerHTML = '';

            ROADMAP_DATA.quarters.forEach(quarter => {
                const column = document.createElement('div');
                column.className = 'quarter-column';
                column.dataset.quarter = quarter;

                const header = document.createElement('div');
                header.className = 'quarter-header';
                header.textContent = QUARTER_DISPLAY[quarter] || quarter;
                column.appendChild(header);

                // Add capacity meter for non-Backlog quarters
                if (quarter !== 'Backlog') {
                    const capacity = calculateCapacity(quarter);
                    const status = getCapacityStatus(capacity);
                    const percentage = Math.min((capacity / QUARTER_CAPACITY) * 100, 100);

                    const meterDiv = document.createElement('div');
                    meterDiv.className = 'capacity-meter';

                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'capacity-info';

                    const textSpan = document.createElement('span');
                    textSpan.className = `capacity-text ${status}`;
                    textSpan.textContent = `${capacity}/${QUARTER_CAPACITY} pts`;
                    infoDiv.appendChild(textSpan);

                    if (status === 'overload') {
                        const badge = document.createElement('span');
                        badge.className = 'warning-badge';
                        badge.textContent = '‚ö† OVERLOAD';
                        infoDiv.appendChild(badge);
                    }

                    meterDiv.appendChild(infoDiv);

                    const barDiv = document.createElement('div');
                    barDiv.className = 'capacity-bar';

                    const fillDiv = document.createElement('div');
                    fillDiv.className = `capacity-fill ${status}`;
                    fillDiv.style.width = `${percentage}%`;
                    barDiv.appendChild(fillDiv);

                    meterDiv.appendChild(barDiv);
                    column.appendChild(meterDiv);
                }

                // Filter initiatives for this quarter
                const quarterInitiatives = ROADMAP_DATA.initiatives.filter(
                    init => init.quarter === quarter
                );

                if (quarterInitiatives.length === 0) {
                    const emptySlot = document.createElement('div');
                    emptySlot.className = 'empty-slot';
                    const img = document.createElement('img');
                    img.src = 'images/empty-slot.jpg';
                    img.alt = 'Place your bet';
                    emptySlot.appendChild(img);
                    column.appendChild(emptySlot);
                }

                quarterInitiatives.forEach(initiative => {
                    const card = createInitiativeCard(initiative);
                    column.appendChild(card);
                });

                if (quarterInitiatives.length === 0) {
                    const placeholder = document.createElement('div');
                    placeholder.className = 'empty-placeholder';
                    placeholder.textContent = quarter === 'Backlog' ? 'The house awaits...' : 'Drop a bet here...';
                    column.appendChild(placeholder);
                }

                grid.appendChild(column);
            });

            // Setup drag and drop after rendering
            setupDragDrop();
            
            // Render dependency arrows
            renderDependencyArrows();
        }

        // Create an initiative card element
        function createInitiativeCard(initiative) {
            const card = document.createElement('div');
            card.className = `initiative-card ${initiative.theme}`;
            if (initiative.completed) {
                card.classList.add('completed');
            }
            card.draggable = true;
            card.dataset.id = initiative.id;

            // Add completion button
            const completeBtn = document.createElement('button');
            completeBtn.className = 'complete-button';
            completeBtn.innerHTML = initiative.completed ? '‚úì' : '‚óã';
            completeBtn.title = initiative.completed ? 'Completed' : 'Mark as complete';
            completeBtn.onclick = (e) => {
                e.stopPropagation();
                if (!initiative.completed) {
                    markAsCompleted(initiative.id);
                }
            };
            card.appendChild(completeBtn);

            const name = document.createElement('div');
            name.className = 'initiative-name';
            name.textContent = initiative.name;
            card.appendChild(name);

            const description = document.createElement('div');
            description.className = 'initiative-description';
            description.textContent = initiative.description;
            card.appendChild(description);

            const badges = document.createElement('div');
            badges.className = 'badges';

            const themeBadge = document.createElement('span');
            themeBadge.className = `badge ${initiative.theme}`;
            themeBadge.textContent = THEME_NAMES[initiative.theme];
            badges.appendChild(themeBadge);

            const sizeBadge = document.createElement('span');
            sizeBadge.className = 'badge size';
            sizeBadge.textContent = initiative.size;
            badges.appendChild(sizeBadge);

            // Add dependency icon if has dependencies
            if (initiative.dependencies && initiative.dependencies.length > 0) {
                const depIcon = document.createElement('span');
                depIcon.className = 'dependency-icon has-deps';
                depIcon.textContent = 'üîó';
                depIcon.title = `Depends on: ${initiative.dependencies.join(', ')}`;
                badges.appendChild(depIcon);
            }

            card.appendChild(badges);

            return card;
        }

        // Move initiative to a different quarter
        function moveInitiative(initiativeId, targetQuarter) {
            const initiative = ROADMAP_DATA.initiatives.find(init => init.id === parseInt(initiativeId));
            if (initiative) {
                initiative.quarter = targetQuarter;
                renderQuarters();
                renderChart();

                // Add landing animation to the moved card
                requestAnimationFrame(() => {
                    const movedCard = document.querySelector(`.initiative-card[data-id="${initiativeId}"]`);
                    if (movedCard) {
                        movedCard.classList.add('card-landing');
                        movedCard.addEventListener('animationend', () => {
                            movedCard.classList.remove('card-landing');
                        }, { once: true });
                    }
                });
            }
        }

        // Render dependency arrows between initiatives
        function renderDependencyArrows() {
            const svg = document.getElementById('dependencySvg');
            const wrapper = svg.parentElement;
            const wrapperRect = wrapper.getBoundingClientRect();
            
            // Clear existing arrows
            svg.innerHTML = '';
            
            // Set SVG dimensions
            svg.setAttribute('width', wrapper.scrollWidth);
            svg.setAttribute('height', wrapper.scrollHeight);

            // Draw arrows for each dependency
            ROADMAP_DATA.initiatives.forEach(initiative => {
                if (!initiative.dependencies || initiative.dependencies.length === 0) return;

                const toCard = document.querySelector(`[data-id="${initiative.id}"]`);
                if (!toCard) return;

                initiative.dependencies.forEach(depId => {
                    const fromCard = document.querySelector(`[data-id="${depId}"]`);
                    if (!fromCard) return;

                    const fromRect = fromCard.getBoundingClientRect();
                    const toRect = toCard.getBoundingClientRect();

                    // Calculate positions relative to wrapper
                    const fromX = fromRect.left - wrapperRect.left + fromRect.width / 2;
                    const fromY = fromRect.top - wrapperRect.top + fromRect.height / 2;
                    const toX = toRect.left - wrapperRect.left + toRect.width / 2;
                    const toY = toRect.top - wrapperRect.top + toRect.height / 2;

                    // Determine arrow color based on dependency type
                    const fromInitiative = ROADMAP_DATA.initiatives.find(i => i.id === depId);
                    let color = '#9ca3af'; // default gray
                    
                    if (fromInitiative && toCard) {
                        const quarterOrder = ["Q1", "Q2", "Q3", "Q4", "Backlog"];
                        const fromIndex = quarterOrder.indexOf(fromInitiative.quarter);
                        const toIndex = quarterOrder.indexOf(initiative.quarter);
                        
                        if (fromIndex > toIndex) {
                            color = '#ef4444'; // red for backward dependency
                        } else if (Math.abs(fromIndex - toIndex) > 1) {
                            color = '#f59e0b'; // orange for cross-quarter
                        }
                    }

                    // Create curved path
                    const midX = (fromX + toX) / 2;
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const d = `M ${fromX} ${fromY} Q ${midX} ${fromY}, ${midX} ${(fromY + toY) / 2} Q ${midX} ${toY}, ${toX} ${toY}`;
                    
                    path.setAttribute('d', d);
                    path.setAttribute('stroke', color);
                    path.setAttribute('stroke-width', '2');
                    path.setAttribute('fill', 'none');
                    path.setAttribute('marker-end', 'url(#arrowhead)');
                    
                    svg.appendChild(path);
                });
            });

            // Add arrowhead marker if not exists
            if (!svg.querySelector('defs')) {
                const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
                marker.setAttribute('id', 'arrowhead');
                marker.setAttribute('markerWidth', '10');
                marker.setAttribute('markerHeight', '10');
                marker.setAttribute('refX', '9');
                marker.setAttribute('refY', '3');
                marker.setAttribute('orient', 'auto');
                
                const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                polygon.setAttribute('points', '0 0, 10 3, 0 6');
                polygon.setAttribute('fill', '#9ca3af');
                
                marker.appendChild(polygon);
                defs.appendChild(marker);
                svg.insertBefore(defs, svg.firstChild);
            }
        }

        // Setup HTML5 drag and drop
        function setupDragDrop() {
            const cards = document.querySelectorAll('.initiative-card');
            const columns = document.querySelectorAll('.quarter-column');

            // Handle drag start
            cards.forEach(card => {
                card.addEventListener('dragstart', (e) => {
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', card.dataset.id);
                    card.classList.add('dragging');
                    // Use card-back image as drag ghost
                    if (dragGhostImage && dragGhostImage.complete) {
                        e.dataTransfer.setDragImage(dragGhostImage, 60, 80);
                    }
                });

                card.addEventListener('dragend', (e) => {
                    card.classList.remove('dragging');
                });
            });

            // Handle drop zones
            columns.forEach(column => {
                column.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    column.classList.add('drag-over');
                });

                column.addEventListener('dragleave', (e) => {
                    if (e.target === column) {
                        column.classList.remove('drag-over');
                    }
                });

                column.addEventListener('drop', (e) => {
                    e.preventDefault();
                    column.classList.remove('drag-over');

                    const initiativeId = e.dataTransfer.getData('text/plain');
                    const targetQuarter = column.dataset.quarter;

                    moveInitiative(initiativeId, targetQuarter);
                });
            });
        }

        // Show spin wheel video overlay
        function showSpinOverlay(callback) {
            const spinVideos = ['spin-wheel-1.mp4', 'spin-wheel-2.mp4', 'spin-wheel-3.mp4'];
            const randomVideo = spinVideos[Math.floor(Math.random() * spinVideos.length)];

            const overlay = document.createElement('div');
            overlay.className = 'spin-overlay';

            const popup = document.createElement('div');
            popup.className = 'spin-popup';

            const title = document.createElement('div');
            title.className = 'spin-title';
            title.textContent = 'Spinning the Wheel...';
            popup.appendChild(title);

            const video = document.createElement('video');
            video.src = `videos/${randomVideo}`;
            video.autoplay = true;
            video.muted = true;
            video.playsInline = true;
            popup.appendChild(video);

            overlay.appendChild(popup);
            document.body.appendChild(overlay);

            video.addEventListener('ended', () => {
                overlay.remove();
                if (callback) callback();
            });

            // Fallback if video fails to load
            video.addEventListener('error', () => {
                overlay.remove();
                if (callback) callback();
            });

            setTimeout(() => {
                if (document.body.contains(overlay)) {
                    overlay.remove();
                    if (callback) callback();
                }
            }, 7000);

            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.remove();
                    if (callback) callback();
                }
            });
        }

        // Spin the Wheel - randomly assign backlog items to Q1-Q4
        function spinTheWheel() {
            const btn = document.getElementById('spinButton');
            btn.classList.add('spinning');
            setTimeout(() => btn.classList.remove('spinning'), 600);

            const backlogItems = ROADMAP_DATA.initiatives.filter(i => i.quarter === 'Backlog');
            if (backlogItems.length === 0) {
                btn.classList.remove('spinning');
                btn.classList.add('no-bets');
                const originalText = btn.textContent;
                btn.textContent = 'üö´ No bets in reserve!';
                setTimeout(() => {
                    btn.classList.remove('no-bets');
                    btn.textContent = originalText;
                }, 1500);
                return;
            }

            const doSpin = () => {
                const targetQuarters = ['Q1', 'Q2', 'Q3', 'Q4'];

                backlogItems.forEach(item => {
                    item.quarter = targetQuarters[Math.floor(Math.random() * targetQuarters.length)];
                });

                renderQuarters();
                renderChart();

                // Add flip animation to the reassigned cards
                requestAnimationFrame(() => {
                    backlogItems.forEach(item => {
                        const card = document.querySelector(`.initiative-card[data-id="${item.id}"]`);
                        if (card) {
                            card.classList.add('card-flip');
                            card.addEventListener('animationend', () => {
                                card.classList.remove('card-flip');
                            }, { once: true });
                        }
                    });
                });
            };

            showSpinOverlay(doSpin);
        }

        // Show bet placed video overlay
        function showBetPlacedOverlay() {
            const overlay = document.createElement('div');
            overlay.className = 'bet-overlay';

            const popup = document.createElement('div');
            popup.className = 'bet-popup';

            const title = document.createElement('div');
            title.className = 'bet-title';
            title.textContent = 'Bet Placed!';
            popup.appendChild(title);

            const video = document.createElement('video');
            video.src = 'videos/bet-placed.mp4';
            video.autoplay = true;
            video.muted = true;
            video.playsInline = true;
            popup.appendChild(video);

            overlay.appendChild(popup);
            document.body.appendChild(overlay);

            video.addEventListener('ended', () => {
                overlay.remove();
            });

            video.addEventListener('error', () => {
                overlay.remove();
            });

            setTimeout(() => {
                if (document.body.contains(overlay)) {
                    overlay.remove();
                }
            }, 7000);

            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.remove();
                }
            });
        }

        // Add new initiative
        function addInitiative(initiativeData) {
            const newId = Math.max(...ROADMAP_DATA.initiatives.map(i => i.id)) + 1;
            const newInitiative = {
                id: newId,
                dependencies: [],
                completed: false,
                ...initiativeData
            };

            ROADMAP_DATA.initiatives.push(newInitiative);
            renderQuarters();
            renderChart();

            // Show bet placed video
            showBetPlacedOverlay();

            // Add landing animation
            requestAnimationFrame(() => {
                const card = document.querySelector(`.initiative-card[data-id="${newId}"]`);
                if (card) {
                    card.classList.add('card-landing');
                    card.addEventListener('animationend', () => {
                        card.classList.remove('card-landing');
                    }, { once: true });
                }
            });
        }

        // Mark initiative as completed
        function markAsCompleted(initiativeId) {
            const initiative = ROADMAP_DATA.initiatives.find(init => init.id === parseInt(initiativeId));
            if (initiative && !initiative.completed) {
                initiative.completed = true;
                showCelebrationPopup();
                renderQuarters();
                // No need to update chart as completed items still count
            }
        }

        // Show celebration popup with random video
        function showCelebrationPopup() {
            // Random video selection
            const videos = ['video1.mp4', 'video2.mp4', 'video3.mp4', 'video4.mp4'];
            const randomVideo = videos[Math.floor(Math.random() * videos.length)];
            const videoPath = `videos/${randomVideo}`;
            const imagePath = 'videos/Generated Image January 27, 2026 - 3_52PM.jpeg';

            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'celebration-overlay';

            // Create popup
            const popup = document.createElement('div');
            popup.className = 'celebration-popup';

            // Create title
            const title = document.createElement('div');
            title.className = 'celebration-title';
            title.textContent = 'üé∞ JACKPOT! üé∞';
            popup.appendChild(title);

            // Create content container for video and image
            const content = document.createElement('div');
            content.className = 'celebration-content';

            // Create video element
            const video = document.createElement('video');
            video.src = videoPath;
            video.autoplay = true;
            video.muted = false;
            video.controls = false;
            content.appendChild(video);

            // Create image element
            const img = document.createElement('img');
            img.src = imagePath;
            img.alt = 'Celebration';
            content.appendChild(img);

            popup.appendChild(content);

            // Create close button
            const closeBtn = document.createElement('button');
            closeBtn.className = 'close-celebration';
            closeBtn.innerHTML = '√ó';
            closeBtn.onclick = () => {
                overlay.remove();
            };
            popup.appendChild(closeBtn);

            overlay.appendChild(popup);
            document.body.appendChild(overlay);

            // Auto-close after video ends or timeout
            video.addEventListener('ended', () => {
                setTimeout(() => {
                    if (document.body.contains(overlay)) {
                        overlay.remove();
                    }
                }, 500);
            });

            // Fallback timeout in case video doesn't load
            setTimeout(() => {
                if (document.body.contains(overlay)) {
                    overlay.remove();
                }
            }, 10000);

            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.remove();
                }
            });
        }

        // Preload card-back drag ghost image
        const dragGhostImage = new Image();
        dragGhostImage.src = 'images/card-back.jpg';
        dragGhostImage.width = 120;
        dragGhostImage.height = 160;

        // Handle form submission
        document.getElementById('addInitiativeForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const formData = {
                name: document.getElementById('initiativeName').value,
                description: document.getElementById('initiativeDescription').value,
                theme: document.getElementById('initiativeTheme').value,
                size: document.getElementById('initiativeSize').value,
                quarter: document.getElementById('initiativeQuarter').value
            };

            addInitiative(formData);

            // Reset form
            e.target.reset();
        });

        // Export roadmap as HTML snapshot
        function exportRoadmap() {
            // Clone the container
            const container = document.querySelector('.container').cloneNode(true);
            
            // Add snapshot banner
            const banner = document.createElement('div');
            banner.className = 'snapshot-banner';
            const now = new Date();
            banner.textContent = `üì∏ Read-Only Snapshot - Exported on ${now.toLocaleDateString()} at ${now.toLocaleTimeString()}`;
            container.insertBefore(banner, container.firstChild);
            
            // Remove interactive elements
            const exportBtn = container.querySelector('#exportButton');
            if (exportBtn) exportBtn.remove();
            
            const spinBtn = container.querySelector('#spinButton');
            if (spinBtn) spinBtn.remove();
            
            const form = container.querySelector('.add-initiative-section');
            if (form) form.remove();
            
            // Convert canvas to image
            const canvas = document.getElementById('balanceChart');
            const chartImg = document.createElement('img');
            chartImg.src = canvas.toDataURL('image/png');
            chartImg.style.maxWidth = '100%';
            
            const chartCanvas = container.querySelector('#balanceChart');
            if (chartCanvas) {
                chartCanvas.parentElement.replaceChild(chartImg, chartCanvas);
            }
            
            // Remove SVG arrows (they don't export well)
            const svg = container.querySelector('.dependency-svg');
            if (svg) svg.remove();
            
            // Remove draggable attributes
            container.querySelectorAll('[draggable]').forEach(el => {
                el.removeAttribute('draggable');
                el.style.cursor = 'default';
            });
            
            // Build complete HTML
            const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roadmap Snapshot - ${now.toLocaleDateString()}</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        ${document.querySelector('style').textContent}
    </style>
</head>
<body>
    ${container.outerHTML}
</body>
</html>`;
            
            // Create and download file
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const dateStr = now.toISOString().split('T')[0];
            a.download = `roadmap-snapshot-${dateStr}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Handle chart mode toggle
        document.getElementById('chartModeToggle').addEventListener('change', (e) => {
            chartMode = e.target.checked ? 'weighted' : 'count';
            renderChart();
        });

        // Handle export button
        document.getElementById('exportButton').addEventListener('click', exportRoadmap);

        // Initialize the app
        function init() {
            // Render roulette rail
            const rail = document.getElementById('rouletteRail');
            const rouletteNumbers = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
            const redNumbers = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
            rouletteNumbers.forEach(num => {
                const dot = document.createElement('div');
                dot.className = `rail-number ${num === 0 ? 'green' : redNumbers.includes(num) ? 'red' : 'black'}`;
                dot.textContent = num;
                rail.appendChild(dot);
            });

            renderQuarters();
            renderChart();
        }

        // Start the app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
